<%! io.github.landgrafhomyak.chatwars.wiki.User %>
<%! io.github.landgrafhomyak.chatwars.wiki.Page %>
<%! kotlin.reflect.KClass %>
<%@ title: String %>
<%@ user: User %>
<%@ page: Page %>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title><%= title %></title>
    <link rel="stylesheet" href="/common.css">
</head>
<body>
<div class="navbar">
    <img class="logo" src="/logo.svg">
    <a href="/">На главную</a>
    <a href="https://telegram.me/chtwrsbot?start=75ad693c5cea4021b2a275847887f8f2">Чат</a>
    <a href="/login">Войти</a>
    <a href="/random">Случайная страница</a>
    <hr>
    <a href="/last_edits">Последние изменения</a>
    <a href="/unchecked_edits">Непроверенные изменения</a>
</div>
<div class="header">
    <div class="account">
        <%=
            when(user) {
                is User.Anonymous -> "<a href='/login'>Войти</a>"
                is User.SessionExpired -> """
                    <b style="color: darkred">Ваша сессия истекла!</b>
                    <a href="#">Ок</a>
                    <a href="/login">Войти ещё раз</a>
                    <div class="sep"></div>
                    <a href='/user/${user.name}'><s>${user.name}</s></a>
                    <div class="sep"></div>
                    <a href='/user/${user.name}?contribution'>Вклад</a>
                """
                is User.Authorized -> """
                    <a href='/user/${user.name}'>${user.name}</a>
                    <div class="sep"></div>
                    <a href='/user/${user.name}?contribution'>Вклад</a>
                    <a href='/logout'>Выйти</a>
                """
            }
        %>
    </div>
    <div class="tabs">
        <%=
            when (page) {
                is Page.Article -> {
                    val s = StringBuilder()
                    s.addHeaderTab<Page.Article.Article>(page, "?", "Статья", false)
                    s.addHeaderTab<Page.Article.Fix>(page, "?fix", "Предложить исправление", true)
                    if (user is User.Authorized) s.addHeaderTab<Page.Article.Edit>(page, "?edit", "Редактировать", true)
                    else s.addHeaderTab<Page.Article.Source>(page, "?source", "Исходный код", true)
                    s.addHeaderTab<Page.Article.History>(page, "?edit", "История", true)
                    s.toString()
                }
                is Page.User -> ""
                is Page.Special -> ""
            }
        %>
        <div class="space-tab">

        </div>
    </div>
</div>
<div class="body"></div>
<div class="footer"></div>
</body>
</html>